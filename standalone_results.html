<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Updated Career Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-title {
            background: linear-gradient(to right, #3B82F6, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold gradient-title mb-4">Your Updated Career Match Results</h1>
            <p class="text-xl text-gray-600">Based on your quiz responses with the fixed algorithm</p>
        </div>

        <div id="loading" class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Loading your results...</p>
        </div>

        <div id="results" class="hidden">
            <!-- Top Match Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-center mb-6">Your #1 Career Match</h2>
                <div id="topMatch"></div>
            </div>

            <!-- Radar Chart Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-center mb-6">Your Career Profile</h2>
                <div id="radarChart" class="text-center">
                    <div class="bg-gradient-to-br from-white to-gray-50 p-6 rounded-xl shadow-xl border border-gray-100">
                        <h3 class="text-2xl font-bold gradient-title mb-2">CAREER RADAR</h3>
                        <p class="text-gray-600 font-medium mb-6">PhD Skills, Values, and Temperament Results</p>
                        <div id="radarScores" class="grid grid-cols-3 gap-4 max-w-4xl mx-auto"></div>
                    </div>
                </div>
            </div>

            <!-- All Matches Section -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-center mb-8">All Your Career Matches</h2>
                <div id="allMatches" class="grid lg:grid-cols-2 gap-6"></div>
            </div>
        </div>
    </div>

    <script>
        const quizAnswers = {
            "skills_technical_1": "c",
            "skills_communication_1": "d",
            "skills_leadership_1": "c",
            "skills_analytical_1": "c",
            "skills_management_1": ["a", "b", "c"],
            "values_impact_1": ["4", "2", "1", "3"],
            "values_autonomy_1": "e",
            "values_stability_1": "a",
            "values_collaboration_1": "d",
            "values_creativity_1": "b",
            "temperament_social_1": "c",
            "temperament_detail_1": "c",
            "temperament_structure_1": "e",
            "temperament_pressure_1": "a",
            "temperament_decision_1": "c",
            "skills_specialized_1": "a",
            "career_goals_1": "d",
            "work_motivation_1": ["1", "4", "3", "2", "5"],
            "risk_tolerance_1": "c",
            "problem_complexity_1": "b",
            "phd_domain_1": "c",
            "technical_depth_1": "b",
            "programming_experience": "b",
            "programming_languages": ["a", "b", "c"],
            "mathematics_background": "b",
            "mathematical_areas": ["a", "b", "c"],
            "data_analysis_experience": "c",
            "data_tools_experience": ["a", "c", "d"],
            "research_methodology": ["a", "f"],
            "technical_writing_experience": "d",
            "business_finance_background": "a",
            "lab_experience": "c",
            "creative_design_experience": "a",
            "clinical_experience": "e"
        };

        function getMatchColor(matchLevel) {
            const level = typeof matchLevel === 'object' ? matchLevel.level : matchLevel;
            switch (level) {
                case 'Strong Match':
                    return 'bg-green-100 text-green-800 border-green-200';
                case 'Good Match':
                    return 'bg-blue-100 text-blue-800 border-blue-200';
                case 'Potential Match':
                    return 'bg-yellow-100 text-yellow-800 border-yellow-200';
                case 'Weak Match':
                    return 'bg-orange-100 text-orange-800 border-orange-200';
                default:
                    return 'bg-gray-100 text-gray-800 border-gray-200';
            }
        }

        function getScoreColor(score) {
            if (score >= 80) return 'text-green-600';
            if (score >= 65) return 'text-blue-600';
            if (score >= 50) return 'text-yellow-600';
            return 'text-gray-600';
        }

        async function loadResults() {
            try {
                const response = await fetch('http://localhost:3000/api/matchCareer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answers: quizAnswers })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                document.getElementById('loading').innerHTML = `
                    <div class="text-center text-red-600">
                        <h3 class="text-xl font-bold mb-2">Error Loading Results</h3>
                        <p>${error.message}</p>
                        <p class="text-sm mt-2">Make sure the development server is running on localhost:3000</p>
                    </div>
                `;
            }
        }

        function displayResults(data) {
            const { matches, radarData } = data;
            
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            // Display top match
            const topMatch = matches[0];
            const topMatchDiv = document.getElementById('topMatch');
            const matchLevel = typeof topMatch.matchLevel === 'object' ? topMatch.matchLevel.level : topMatch.matchLevel;
            
            topMatchDiv.innerHTML = `
                <div class="text-center">
                    <div class="flex items-center justify-center gap-4 mb-4">
                        <span class="px-4 py-2 rounded-full text-sm font-medium border ${getMatchColor(matchLevel)}">
                            ${matchLevel}
                        </span>
                        <span class="text-2xl font-bold ${getScoreColor(topMatch.score)}">
                            ${topMatch.score}% Match
                        </span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-900 mb-4">
                        ${topMatch.details?.name || topMatch.careerPath.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                    </h3>
                    <p class="text-lg text-gray-700">
                        ${topMatch.details?.description || 'A great career path that matches your profile.'}
                    </p>
                </div>
            `;

            // Display radar scores
            const radarScoresDiv = document.getElementById('radarScores');
            let radarHTML = '';
            
            radarData.categories.forEach((category, index) => {
                const score = Math.round(radarData.scores[index] * 100);
                let colorClass = 'text-blue-600';
                if (score >= 70) colorClass = 'text-green-600';
                else if (score >= 50) colorClass = 'text-yellow-600';
                else if (score < 35) colorClass = 'text-red-600';
                
                radarHTML += `
                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl font-bold ${colorClass} mb-1">${score}%</div>
                        <div class="text-sm font-medium text-gray-700">${category.toUpperCase()}</div>
                    </div>
                `;
            });
            radarScoresDiv.innerHTML = radarHTML;

            // Display all matches
            const allMatchesDiv = document.getElementById('allMatches');
            let matchesHTML = '';
            
            matches.forEach((match, index) => {
                const matchLevel = typeof match.matchLevel === 'object' ? match.matchLevel.level : match.matchLevel;
                matchesHTML += `
                    <div class="bg-gray-50 rounded-lg shadow p-6 hover:shadow-xl transition-shadow">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">
                                    ${match.details?.name || match.careerPath.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                </h3>
                                <span class="px-3 py-1 rounded-full text-sm font-medium border ${getMatchColor(matchLevel)}">
                                    #${index + 1} â€¢ ${matchLevel}
                                </span>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${getScoreColor(match.score)}">
                                    ${match.score}%
                                </div>
                                <div class="text-sm text-gray-500">Match Score</div>
                            </div>
                        </div>
                        <p class="text-gray-600">
                            ${match.details?.description || 'A career path that aligns with your assessment results.'}
                        </p>
                    </div>
                `;
            });
            allMatchesDiv.innerHTML = matchesHTML;
        }

        // Load results when page loads
        loadResults();
    </script>
</body>
</html>