import React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport Layout from '../../components/Layout';\nimport { MiniCareerMap } from '../../components/CareerMap';\n\nconst ResultsPage = () => {\n  const router = useRouter();\n  const [matches, setMatches] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [quizAnswers, setQuizAnswers] = useState(null);\n\n  useEffect(() => {\n    // Get quiz answers from sessionStorage\n    const storedAnswers = sessionStorage.getItem('quizAnswers');\n    \n    if (!storedAnswers) {\n      // Redirect to quiz if no answers found\n      router.push('/quiz/');\n      return;\n    }\n\n    try {\n      const answers = JSON.parse(storedAnswers);\n      setQuizAnswers(answers);\n      fetchCareerMatches(answers);\n    } catch (err) {\n      setError('Invalid quiz data. Please retake the assessment.');\n      setLoading(false);\n    }\n  }, [router]);\n\n  const fetchCareerMatches = async (answers) => {\n    try {\n      const response = await fetch('/api/matchCareer', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ answers }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      setMatches(data.matches);\n    } catch (err) {\n      setError('Failed to analyze your responses. Please try again.');\n      console.error('Error fetching career matches:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getMatchColor = (matchLevel) => {\n    switch (matchLevel) {\n      case 'Excellent Match':\n        return 'bg-green-100 text-green-800 border-green-200';\n      case 'Good Match':\n        return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'Moderate Match':\n        return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      default:\n        return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  const getScoreColor = (score) => {\n    if (score >= 0.8) return 'text-green-600';\n    if (score >= 0.65) return 'text-blue-600';\n    if (score >= 0.5) return 'text-yellow-600';\n    return 'text-gray-600';\n  };\n\n  if (loading) {\n    return (\n      <Layout \n        title=\"Analyzing Your Results - IndustryCareerGuide\"\n        description=\"We're analyzing your career assessment responses to provide personalized recommendations.\"\n      >\n        <div className=\"section-padding bg-primary-50\">\n          <div className=\"container-max max-w-2xl text-center\">\n            <div className=\"animate-fade-in\">\n              <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto mb-6\"></div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Analyzing Your Responses</h1>\n              <p className=\"text-gray-600\">\n                We're matching your skills, values, and preferences with industry career paths...\n              </p>\n            </div>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (error) {\n    return (\n      <Layout \n        title=\"Error - IndustryCareerGuide\"\n        description=\"There was an error processing your career assessment.\"\n      >\n        <div className=\"section-padding bg-red-50\">\n          <div className=\"container-max max-w-2xl text-center\">\n            <div className=\"w-20 h-20 bg-red-500 text-white rounded-full flex items-center justify-center text-3xl mx-auto mb-6\">\n              ⚠️\n            </div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Something Went Wrong</h1>\n            <p className=\"text-gray-600 mb-8\">{error}</p>\n            <Link href=\"/quiz/\" className=\"btn-primary\">\n              Retake Assessment\n            </Link>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (!matches || matches.length === 0) {\n    return (\n      <Layout \n        title=\"No Matches Found - IndustryCareerGuide\"\n        description=\"No career matches were found for your assessment responses.\"\n      >\n        <div className=\"section-padding\">\n          <div className=\"container-max max-w-2xl text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">No Matches Found</h1>\n            <p className=\"text-gray-600 mb-8\">\n              We couldn't find suitable career matches. Please try retaking the assessment.\n            </p>\n            <Link href=\"/quiz/\" className=\"btn-primary\">\n              Retake Assessment\n            </Link>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  const topMatch = matches[0];\n\n  return (\n    <Layout \n      title=\"Your Career Match Results - IndustryCareerGuide\"\n      description={`Your top career match is ${topMatch.careerPath.replace('_', ' ')}. Explore your personalized career recommendations.`}\n      canonicalUrl=\"/results/\"\n    >\n      <div className=\"bg-gray-50 min-h-screen\">\n        {/* Header Section */}\n        <section className=\"bg-gradient-to-r from-primary-600 to-purple-600 text-white section-padding\">\n          <div className=\"container-max text-center\">\n            <h1 className=\"text-3xl md:text-4xl font-bold mb-4\">\n              Your Career Match Results\n            </h1>\n            <p className=\"text-xl opacity-90 max-w-2xl mx-auto\">\n              Based on your assessment, we've identified the best career paths that align with your skills, values, and ambitions.\n            </p>\n          </div>\n        </section>\n\n        {/* Top Match Highlight */}\n        <section className=\"bg-white border-b\">\n          <div className=\"container-max section-padding\">\n            <div className=\"text-center mb-8\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Your #1 Career Match</h2>\n              <div className=\"flex items-center justify-center gap-4\">\n                <span className={`px-4 py-2 rounded-full text-sm font-medium border ${getMatchColor(topMatch.matchLevel)}`}>\n                  {topMatch.matchLevel}\n                </span>\n                <span className={`text-2xl font-bold ${getScoreColor(topMatch.score)}`}>\n                  {Math.round(topMatch.score * 100)}% Match\n                </span>\n              </div>\n            </div>\n            \n            <div className=\"max-w-4xl mx-auto\">\n              <div className=\"bg-gradient-to-r from-primary-50 to-purple-50 rounded-lg p-8 mb-8\">\n                <h3 className=\"text-3xl font-bold text-gray-900 mb-4 text-center\">\n                  {topMatch.details?.name || topMatch.careerPath.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n                </h3>\n                <p className=\"text-lg text-gray-700 text-center mb-6\">\n                  {topMatch.details?.description || 'A great career path that matches your profile.'}\n                </p>\n                \n                {topMatch.details && (\n                  <div className=\"grid md:grid-cols-3 gap-6\">\n                    <div className=\"text-center\">\n                      <h4 className=\"font-semibold text-gray-800 mb-2\">Entry Level Salary</h4>\n                      <p className=\"text-primary-600 font-bold\">\n                        {topMatch.details.career_progression?.entry_level?.salary_range || 'Varies'}\n                      </p>\n                    </div>\n                    <div className=\"text-center\">\n                      <h4 className=\"font-semibold text-gray-800 mb-2\">Growth Potential</h4>\n                      <p className=\"text-primary-600 font-bold\">\n                        {topMatch.details.career_progression?.senior_level?.salary_range || 'High'}\n                      </p>\n                    </div>\n                    <div className=\"text-center\">\n                      <h4 className=\"font-semibold text-gray-800 mb-2\">Top Industries</h4>\n                      <p className=\"text-primary-600 font-bold\">\n                        {topMatch.details.industries?.slice(0, 2).join(', ') || 'Multiple'}\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"text-center\">\n                <Link \n                  href={`/actionPlan/?career=${topMatch.careerPath}`}\n                  className=\"btn-primary text-lg px-8 py-3 mr-4\"\n                >\n                  Get Your Action Plan\n                </Link>\n                <Link \n                  href={`/careerMap/?path=${topMatch.careerPath}`}\n                  className=\"btn-secondary text-lg px-8 py-3\"\n                >\n                  View Career Map\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* All Matches */}\n        <section className=\"section-padding\">\n          <div className=\"container-max\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-8 text-center\">\n              All Your Career Matches\n            </h2>\n            \n            <div className=\"grid lg:grid-cols-2 gap-8\">\n              {matches.map((match, index) => (\n                <div key={index} className=\"bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div>\n                      <h3 className=\"text-xl font-bold text-gray-900 mb-2\">\n                        {match.details?.name || match.careerPath.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n                      </h3>\n                      <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getMatchColor(match.matchLevel)}`}>\n                        #{index + 1} • {match.matchLevel}\n                      </span>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className={`text-2xl font-bold ${getScoreColor(match.score)}`}>\n                        {Math.round(match.score * 100)}%\n                      </div>\n                      <div className=\"text-sm text-gray-500\">Match Score</div>\n                    </div>\n                  </div>\n                  \n                  <p className=\"text-gray-600 mb-4\">\n                    {match.details?.description || 'A career path that aligns with your assessment results.'}\n                  </p>\n                  \n                  <div className=\"mb-4\">\n                    <MiniCareerMap careerPath={match.careerPath} maxStages={3} />\n                  </div>\n                  \n                  <div className=\"flex gap-3\">\n                    <Link \n                      href={`/careerMap/?path=${match.careerPath}`}\n                      className=\"flex-1 text-center py-2 px-4 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors\"\n                    >\n                      View Details\n                    </Link>\n                    <Link \n                      href={`/actionPlan/?career=${match.careerPath}`}\n                      className=\"flex-1 text-center py-2 px-4 border border-primary-600 text-primary-600 rounded hover:bg-primary-50 transition-colors\"\n                    >\n                      Action Plan\n                    </Link>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Next Steps */}\n        <section className=\"bg-primary-50 section-padding\">\n          <div className=\"container-max text-center\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n              Ready to Take Action?\n            </h2>\n            <p className=\"text-lg text-gray-600 max-w-2xl mx-auto mb-8\">\n              Now that you know your best career matches, take the next step toward your industry transition.\n            </p>\n            \n            <div className=\"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n              <div className=\"bg-white p-6 rounded-lg shadow\">\n                <div className=\"text-3xl mb-4\">📋</div>\n                <h3 className=\"font-semibold mb-2\">Get Your Action Plan</h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Personalized roadmap with courses, certifications, and milestones\n                </p>\n                <Link \n                  href={`/actionPlan/?career=${topMatch.careerPath}`}\n                  className=\"btn-primary w-full\"\n                >\n                  Create Plan\n                </Link>\n              </div>\n              \n              <div className=\"bg-white p-6 rounded-lg shadow\">\n                <div className=\"text-3xl mb-4\">📄</div>\n                <h3 className=\"font-semibold mb-2\">Optimize Your Resume</h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Industry-specific templates and PhD-to-industry guidance\n                </p>\n                <a \n                  href=\"https://industryresume.com\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"btn-secondary w-full\"\n                >\n                  Get Resume Help\n                </a>\n              </div>\n              \n              <div className=\"bg-white p-6 rounded-lg shadow\">\n                <div className=\"text-3xl mb-4\">🗺️</div>\n                <h3 className=\"font-semibold mb-2\">Explore Career Maps</h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Interactive progression paths with skills and timelines\n                </p>\n                <Link \n                  href=\"/careerMap/\"\n                  className=\"btn-secondary w-full\"\n                >\n                  View All Paths\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Retake Option */}\n        <section className=\"bg-white border-t section-padding\">\n          <div className=\"container-max text-center\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              Want Different Results?\n            </h3>\n            <p className=\"text-gray-600 mb-6\">\n              If these results don't feel right, you can retake the assessment to get new recommendations.\n            </p>\n            <Link href=\"/quiz/\" className=\"btn-secondary\">\n              Retake Assessment\n            </Link>\n          </div>\n        </section>\n      </div>\n    </Layout>\n  );\n};\n\nexport default ResultsPage;